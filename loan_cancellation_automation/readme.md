# Loan Cancellation Emailer Docs
## Updates
19-03-21 - Initial Commit

## Overview
This is a three-step automated process that uses the output from an Informer report to send emails to students notifying them that they have been awarded loans and that they have the right to cancel them. It was setup by Josh at the request of Meaghan Isgett.
## Workflow
The workflow has three main components: Informer, main.py, and Loan Cancellation Emailer Google Apps Script file. The reasoning behind separating the last two components into different steps is explained later in these docs.
### Informer
The process starts with an Informer report named “XBOL_Daily” that is scheduled to run every day at 10:05am. This exports the data from the XBOL report into a csv located on the Informer server (C:/Student_Accounts/XBOL_Daily.csv).
### main.py
This is a Python 3 script that reads the data from the XBOL_Daily.csv file, parses it, and appends it to a Google Sheet (current link). It is also located on the Informer server (C:/Student_Accounts/main.py), and references other files detailed below, all in the same directory. This file keeps logs of its activity and will send an email notification if it encounters an error.

#### Additional Files Required by main.py (detailed below)
1. sendErrorEmail.py
2. config.json
3. API_Keys.json

### Loan Cancellation Emailer (GAS)
This is the final part of the process, which accesses the Google Sheet for the data and builds the email notifications, then sends them to the individual recipients.

[Link to script file](https://script.google.com/a/coker.edu/d/1AlneSrH33k3hqxWv66kIAKAU7lfu4MO2VMre2qUouf0XjqBiNdPyjoI4/edit?usp=drive_web&folder=1YbFZc-YW_NQ27jraQLTQaw9zVub4X2SN&splash=yes)
I have included a copy in this repo, but it needs to be hosted in Google Drive, etc.

## Additional Files Required by main.py
### sendErrorEmail.py
This is a custom Python module that simply sends an email if an error is encountered. It references config.json to get the email information
### Config File
Stored in the same directory as main.py, named “config.json”. This is a file that contains the Gmail address and App Password (not the account password) for the Gmail account that sends a notification email if there is an error. It is NOT the email address that is used to send out the actual Loan Cancellation letters. It is formatted as follows:

```json
{
  "fromEmailAddress": "sendingEmail@example.com",
  "fromEmailPassword": "passwordhere",
  "toEmailAddress": "recipientEmail@example.com"
}
```

### API_Keys.json
This is a json file generated by Google for accessing their APIs, and are specific to a user. To generate new API keys, follow this guide: https://cloud.google.com/iam/docs/creating-managing-service-account-keys

After downloading the file, rename to API_Keys.json and save to the same directory as main.py.
## Reasoning for Using Three Components
This process could be completed using only two components (Informer and Python). However, I chose to use three components for a few reasons.

1. This allows us to schedule the spreadsheet updates hours in advance of the emails being sent, which gives us the ability to stop them from going out if there is a problem.
2. A Google Apps Script (GAS) script can be easily attached to a spreadsheet owned by another user and can be run by them with a few clicks. Doing so from Python would require the creation of an App Password which is then hard-coded into the config file. This is obviously more difficult, as well as being a huge security problem because anyone with that password would be able to send emails on behalf of the user.
3. Google supports GAS much better than they do Python, meaning we are less dependant on third-party modules and the possible conflicts they can cause.
4. GAS has built-in html templating, making it easier and faster to send html emails using it than doing so with Python.
## Video Explanation of Code
[Video Link](https://drive.google.com/open?id=14dQbyXsca3DeiG3A8VEZtgsJTh6RbySF)
